# ===============================================
# PostgreSQL Production Configuration
# 운영환경 배포시 적용할 설정 파일
# ===============================================

# === 데이터 안전성 (운영환경 필수) ===
synchronous_commit = on              # 트랜잭션 안전성 보장
fsync = on                          # 디스크 동기화 보장
full_page_writes = on               # 페이지 부정합 방지
wal_sync_method = fdatasync         # 안정적인 WAL 동기화

# === 메모리 설정 (서버 사양에 맞게 조정) ===
shared_buffers = 2GB                # 총 메모리의 25% (8GB 서버 기준)
work_mem = 32MB                     # 운영환경에서 적절한 크기
maintenance_work_mem = 1GB          # 큰 작업용 메모리
effective_cache_size = 6GB          # 시스템 캐시 크기

# === 연결 관리 ===
max_connections = 100               # 운영환경 적정 연결수
shared_preload_libraries = 'timescaledb'

# === WAL 설정 ===
wal_buffers = 16MB                  # WAL 버퍼 크기
checkpoint_completion_target = 0.9   # 체크포인트 분산
max_wal_size = 2GB                  # WAL 최대 크기

# === 쿼리 최적화 ===
random_page_cost = 1.1              # SSD 기준 설정
temp_buffers = 64MB                 # 임시 버퍼

# === 로깅 (운영환경 모니터링) ===
log_destination = 'stderr'
log_min_duration_statement = 5000   # 5초 이상 쿼리 로깅
log_statement = 'ddl'               # DDL 명령 로깅
log_checkpoints = on                # 체크포인트 로깅

# === TimescaleDB 특화 설정 ===
timescaledb.max_background_workers = 8